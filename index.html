<!--
    Documento principal da solução CAPEX Forms.
    Nesta etapa fiz uma rodada de comentários para descrever como o layout
    está organizado e quais decisões tomei anteriormente para atender os
    pedidos do usuário. A intenção é facilitar uma próxima revisão, já que
    o protótipo evoluiu bastante ao longo das últimas interações.
-->
<html lang="pt-BR">

<head>
    <!-- Metadados básicos e a folha de estilo que controla o visual da página -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Formulário de Projeto - CAPEX</title>
    <link rel="stylesheet" href="style.css">
</head>

<body id="static-mirror">
    <!-- Cabeçalho com logotipo e botão de criação de novos projetos -->
    <header class="main-header">
        <div class="logo"></div>
        <button type="button" id="newProjectBtn" class="new-project-btn">Novo Projeto</button>
    </header>
    <!-- Wrapper que divide a tela entre a lista lateral e os detalhes do projeto -->
    <div id="app">
        <!-- Barra lateral dedicada à listagem rolável de projetos -->
        <aside id="projectSidebar">
            <div id="projectList"></div>
        </aside>
        <!-- Painel principal, usado para detalhes do projeto ou mensagem inicial -->
        <main id="projectDetails">
            <div class="project-details">
                <!-- Estado vazio padrão orientando o usuário a selecionar algo -->
                <div class="empty">
                    <p class="empty-title">Selecione um projeto</p>
                    <p>Clique em um projeto na lista ao lado para ver os detalhes</p>
                </div>
            </div>
        </main>
    </div>
    <!-- Formulário completo de cadastro/edição, mantido oculto no protótipo -->
    <form id="capexForm" novalidate style="display: none;">
            <button type="button" id="backBtn" class="btn" style="display:none;"><span class="material-symbols-outlined">arrow_back</span> Voltar</button>
            <h2>Novo Projeto de CAPEX Normativo</h2>
            <p class="hint">Preencha os dados do projeto. Se o <strong>CAPEX BUDGET</strong> for superior a <strong>R$ 500.000,00</strong>, você deverá adicionar <em>marcos</em> (milestones) e ao menos 2 atividade em cada marco.</p>
            <div id="status" class="status" role="status" aria-live="polite"></div>
            <div id="errors" class="error-box" style="display:none;" role="alert" aria-live="assertive"></div>

            <!-- Bloco principal com informações estruturais exigidas pelo SAP -->
            <fieldset>
                <legend>Informações SAP</legend>
                <div class="grid">
                    <div class="col-6">
                        <label for="projectName">Nome do Projeto</label>
                        <input id="projectName" name="projectName" type="text" required
                            placeholder="Ex.: Modernização da Linha de Laminação" />
                    </div>
                    
                    <div class="col-3">
                        <label for="approvalYear">Ano de aprovação</label>
                        <input id="approvalYear" name="approvalYear" type="number" min="1900" required />
                    </div>
                    
                    <div class="col-3">
                        <label for="unit">Unidade</label>
                        <select id="unit" name="unit" required>
                            <option value="">Selecione…</option>
                            <option>Andrade</option>
                            <option>Barra Mansa</option>
                            <option>CEO</option>
                            <option>CFTV</option>
                            <option>Dir Logísitca e Planejamento</option>
                            <option>ECA</option>
                            <option>Suprimentos</option>
                            <option>Guilman Amorim</option>
                            <option>Juiz de Fora</option>
                            <option>Metálicos</option>
                            <option>Monlevade</option>
                            <option>Piracicaba</option>
                            <option>Resende</option>
                            <option>Rio das Pedras</option>
                            <option>Serra Azul</option>
                            <option>Sitrel</option>
                            <option>TI Corporativo</option>
                            <option>TI Shared Services</option>
                            <option>Trefilaria Juiz de Fora</option>
                            <option>Trefilaria Resende</option>
                            <option>Trefilaria Sabará</option>
                            <option>Trefilaria São Paulo</option>
                            <option>VP Comercial</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label for="center">Centro</label>
                        <input id="center" name="center" type="text" required />
                    </div>
                    <div class="col-3">
                        <label for="projectLocation">Local da implantação do projeto</label>
                        <select id="projectLocation" name="projectLocation" required>
                            <option value="">Selecione…</option>
                            <option>Aciaria</option>
                            <option>Alto Forno</option>
                            <option>Cilindro e Discos Laminação</option>
                            <option>Engenharia e Utilidades</option>
                            <option>Guilman Amorim</option>
                            <option>Geral</option>
                            <option>Gerência Técnica | Qualidade</option>
                            <option>Suprimentos Monlevade</option>
                            <option>Laminação</option>
                            <option>Logística | Estocagem | Expedição</option>
                            <option>Melhorias Ambientais</option>
                            <option>Melhorias Seguranças</option>
                            <option>Redução</option>
                            <option>Recursos Humanos</option>
                            <option>Sinterização</option>
                            <option>Tecnologia da Informação</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label for="projectUser">Project User do Projeto</label>
                        <input id="projectUser" name="projectUser" type="text" required />
                    </div>
                    <div class="col-3">
                        <label for="projectLeader">Project Leader</label>
                        <input id="projectLeader" name="projectLeader" type="text" required />
                    </div>
                    <div class="col-3">
                        <label for="investmentType">Tipo de investimento</label>
                        <select id="investmentType" name="investmentType" required>
                            <option value="">Selecione…</option>
                            <option>Estratégico</option>
                            <option>Normativo</option>
                            <option>Reline</option>
                            </select>
                    </div>
                    <div class="col-3">
                        <label for="assetType">Tipo de ativo</label>
                        <input id="assetType" name="assetType" type="text" required />
                    </div>
                    <div class="col-3">
                        <label for="usefulLife">Vida útil do projeto (anos)</label>
                        <input id="usefulLife" name="usefulLife" type="number" min="0" required />
                    </div>
                    <div class="col-3">
                        <label for="projectValue">CAPEX BUDGET do Projeto (BRL)</label>
                        <input id="projectValue" name="projectValue" type="number" min="0" step="0.01"
                            inputmode="decimal" required placeholder="500.000,00" />
                        <div id="capexFlag" class="muted"></div>
                    </div>
                </div>
            </fieldset>
<!--------------------------------------------------------------------------->
<!--Aparece depois do valor de R4500.000-->

            <div id="milestoneSection" style="display:none;">
                <fieldset>
                    
                    <legend><h1>KEY PROJECTS</h1></legend>
                <div class="grid">
            <!-- Área condicionada que só aparece quando o orçamento ultrapassa o limite -->
            <div class="col-6">
                        <label>Projetos acima de R$ 500.000,00 são classificados como
                            estratégicos para o negócio e, por isso, serão acompanhados com
                            aplicação aprofundada da metodologia de gestão de projetos CIPM.
                            Para garantir a devida governança, solicitamos o preenchimento das
                            informações abaixo:
                        </label>
                    </div>
                               
                    <div class="col-6">
                        <label><strong>a. </strong> Qual a necessidade do negócio?</label>
                        <textarea id="necessidade" name="necessidade" required 
                        placeholder="Digite aqui a necessidade do negócio..."></textarea>
                    </div>

                    <div class="col-6">
                        <label><strong>b.</strong> Descreva sobre a solução proposta:</label>
                        <textarea id="solucao" name="solucao" required 
                        placeholder="Digite aqui os detalhes da solução proposta..."></textarea>
                    </div>
                
                    <div class="col-3">
                        <label><strong>c.</strong> KPI que o projeto vai impactar</label>
                        <input id="kpi" name="kpi" type="text" required
                         placeholder="Ex.: Produtividade, Segurança, Qualidade..." />
                    </div>
                                        
                    <div class="col-3">
                        <label><strong>d.</strong> Descrição do KPI</label>
                        <textarea id="kpiDesc" name="kpiDesc" required
                        placeholder="Explique como o KPI será impactado pelo projeto..."></textarea>
                    </div>
            
                    <div class="col-3">
                        <label><strong>e.</strong> Qual valor atual do KPI?</label>
                        <input id="kpi_actual" name="kpi_actual" type="number" required
                         placeholder="Ex.: média dos ultimos dois anos..." />
                    </div>

                    <div class="col-3">
                        <label><strong>f.</strong> Qual o valor esperado do KPI após o projeto?</label>
                        <input id="kpi_expected" name="kpi_expected" type="number" required
                         placeholder="Ex.: valor que será obtido após o projeto ser finalizado..." />
                    </div>

                    
                </div>    
            
                    <!-- Controles para criar marcos e informar o usuário sobre as regras -->
                    <div class="btn-row vs">
                        <button class="btn" type="button" id="addMilestoneBtn">+ Adicionar marco</button>
                        <!-- <span id="milestoneReq" class="badge" title="Obrigatório quando CAPEX &gt; R$ 1,5 mi">requisito -->
                            <!-- condicionado ao CAPEX</span> -->
                    </div>
                    <div id="milestones"></div>
                    <div class="muted">Cada marco deve possuir pelo menos <strong>2 atividade</strong> com todos os campos
                        válidos e preenchidos.</div>
                </fieldset>

                <div class="divider"></div>
            </div>

            <!-- Botões finais que controlam o envio ou limpeza do formulário -->
            <div class="btn-row right">
                <button type="reset" class="btn ghost"><span class="material-symbols-outlined">cleaning_services</span> Limpar</button>
                <button type="button" id="saveDraftBtn" class="btn secondary"><span class="material-symbols-outlined">save_as</span> Salvar rascunho</button>
                <button type="submit" class="btn primary"><span class="material-symbols-outlined">send</span> Enviar formulário</button>
            </div>
        </form>

        <!-- Espaço reservado para visualizar cronogramas quando implementado -->
        <h3 id="ganttCharTitle" style="display: none;">Programação do Projeto</h3>
        <div id="ganttChart"></div>

    <!-- Templates -->
    <!-- Estruturas reutilizáveis para marcos e atividades, clonadas dinamicamente via JS -->
    <template id="milestoneTemplate">
        <details class="milestone" data-milestone>
            <summary>Marco X</summary>
            <div class="milestone-header">
                <div class="milestone-title" style="min-width:260px;">
                    <label>Nome do marco</label>
                    <input type="text" class="milestone-name" required />
                </div>
                <div class="btn-row">
                    <button type="button" class="btn" data-add-activity>+ Adicionar atividade</button>
                    <button type="button" class="btn danger" data-remove-milestone>Remover marco</button>
                </div>
            </div>
            <div class="activities" data-activities></div>
        </details>
    </template>

    <template id="activityTemplate">
        <div class="activity" data-activity>
            <div class="row">
                <div class="c-6">
                    <label>Título da atividade</label>
                    <input type="text" class="act-title" required placeholder="Ex.: Compra do laminador" />
                </div>
                <div class="c-3">
                    <label>Data de início</label>
                    <input type="date" class="act-start" required />
                </div>
                <div class="c-3">
                    <label>Data de fim</label>
                    <input type="date" class="act-end" required />
                </div>
            </div>
            <div data-year-fields></div>
            <div>
                <label for="Elemento_PEP">Escolha o elemento PEP para a atividade</label>
                <select id="Elemento_PEP" name="kpi" required>
                    <option value="">Selecione…</option>
                    <option>DESP.ENGENHARIA / DETALHAMENTO PROJETO</option>
                    <option>AQUISIÇÃO DE EQUIPAMENTOS NACIONAIS</option>
                    <option>AQUISIÇÃO DE EQUIPAMENTOS IMPORTADOS</option>
                    <option>AQUISIÇÃO DE VEÍCULOS</option>
                    <option>DESPESAS COM OBRAS CIVIS</option>
                    <option>DESP.MONTAGEM EQUIPTOS/ESTRUTURAS/OUTRAS</option>
                    <option>AQ.DE COMPONENTES/MAT.INSTAL./FERRAMENTA</option>
                    <option>DESPESAS COM MEIO AMBIENTE</option>
                    <option>DESPESAS COM SEGURANÇA</option>
                    <option>DESPESAS COM SEGUROS</option>
                    <option>DESP.CONSULTORIA INTERNA (AMS)-TEC.INFOR</option>
                    <option>DESP.CONSULTORIA EXTERNA - TEC.INFOR</option>
                    <option>AQUISIÇÃO DE HARDWARE (NOTEBOOKS, ETC)</option>
                    <option>DESP.GERENCIAMENTO E COORDENAÇÃO</option>
                    <option>AQUISIÇÃO DE SOFTWARE</option>
                    <option>CONTINGÊNCIAS</option>
                </select>
            </div>
            <div class="c-12 btn-row vs">
                <button type="button" class="btn danger icon" data-remove-activity><span class="material-symbols-outlined">delete</span></button>
            </div>
        </div>
    </template>
      <!-- Bibliotecas necessárias para o gráfico de Gantt e para a lógica da página -->
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script src="./script.js"></script>
  </body>

</html>
